<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>新建文件</title>
</head>
<link rel="stylesheet" href="../layui/css/layui.css">
<link rel="stylesheet" href="../css/index.css">
<body>
<script type="text/html" id="chooseFile">
    <form class="layui-form" action="" style="margin-top:20px;">
        <label class="layui-form-label">选择文件：</label>
        <button type="button" class="layui-btn" id="test3"><i class="layui-icon"></i>选择文件</button>
        <div class="layui-form-item layui-form-text">
            <label class="layui-form-label">文件描述：</label>
            <div class="layui-input-block">
                <textarea placeholder="文件描述" class="layui-textarea"></textarea>
            </div>
        </div>
        <div class="layui-form-item">
            <button class="layui-btn" lay-submit lay-filter="addentryplan" style="margin-left: 450px ">确认</button>
        </div>
    </form>
</script>

<script type="text/html" id="chooseFileType">
    <form class="layui-form" action="" style="margin-top:20px;">
        <label class="layui-form-label">选择文件类型：</label>
        <button type="button" class="layui-btn" id="fileType"><i class="layui-icon"></i>选择文件类型</button>
        <div class="layui-form-item layui-form-text">

        </div>
        <div class="layui-form-item">
            <button class="layui-btn" lay-submit lay-filter="addentryplan" style="margin-left: 450px ">确认</button>
        </div>
    </form>
</script>

<div class="layui-row layui-col-space15">
    <div class="layui-col-md7">
        <form class="layui-form" action="" id="addform">
            <div class="layui-form-item">
                <i class="required-color">*</i><label class="layui-form-label">标题:</label>
                <div class="layui-input-block">
                    <input type="text" name="title" required lay-verify="required" placeholder="请输入标题"
                           style="width: 400px" autocomplete="off" class="layui-input">
                </div>
            </div>
            <i class="required-color">*</i><label class="layui-form-label">类型:</label>
            <div class="layui-input-block">
                <input type="text" name="title" required lay-verify="required" placeholder="请输入类型"
                        style="width: 400px" autocomplete="off" class="layui-input" th:onclick="'javascript:add()'">
            </div>
            <br/>
            <div  style="margin-top:30px">
            <label class="layui-form-label">文件封面:</label>
            <button type="button" class="layui-btn" id="test1" >
                <i class="layui-icon">&#xe67c;</i>上传文件封面
            </button>
            </div>
            <input type="hidden" name="type" id="type" value="1"/>
            <div class="layui-form-item layui-form-text" style="margin-top: 38px">
                <label class="layui-form-label">编辑器:&nbsp;&nbsp;</label>
                <div class="layui-input-block">
                    <textarea class="layui-textarea layui-hide" name="content" lay-verify="content"
                              id="LAY_demo_editor"></textarea>
                </div>
            </div>
            <button class="layui-btn layui-btn-primary layui-btn-small">附件上传</button>

            <i class="required-color">*</i><label class="layui-form-label" style="margin-top: 50px ">权限设置:</label>
            <div class="layui-form-item layui-form-text">
                <label class="layui-form-label">可查阅人员</label>
                <div class="layui-input-block">
                    <textarea placeholder="" class="layui-textarea"  style="margin-top :-50px"></textarea>
                </div>
                <div>
                <button class="layui-btn layui-btn-primary layui-btn-mini" style="margin-left:1100px;color:blue">选择人员</button>
                </div>
            </div>
            <div class="layui-form-item layui-form-text">
                <label class="layui-form-label">可编辑人员</label>
                <div class="layui-input-block">
                    <textarea placeholder="" class="layui-textarea"></textarea>
                </div>
                <div>
                    <button class="layui-btn layui-btn-primary layui-btn-mini" style="margin-left:1100px;color:blue">选择人员</button>
                </div>
            </div>
            <div class="layui-form-item layui-form-text">
                <label class="layui-form-label">可删除人员</label>
                <div class="layui-input-block">
                    <textarea placeholder="" class="layui-textarea"></textarea>
                </div>
                <div>
                    <button class="layui-btn layui-btn-primary layui-btn-mini" style="margin-left:1100px;color:blue">选择人员</button>
                </div>
            </div>
            <div class="layui-form-item">
                <div class="layui-input-block">
                    <button class="layui-btn" lay-submit lay-filter="formDemo" id="demo1">确定上传</button>
                </div>
            </div>
        </form>
        <div class="grid-demo grid-demo-bg1"></div>
    </div>
</div>
<script src="../layui/layui.js"></script>
<script src="../js/jquery-1.8.3.min.js"></script>
<script src="../js/ztree/js/jquery.ztree.all.min.js"></script>
<script>
    var treedata;
    var treeObj;
    var setting = {
        async: {
            enable: false
        },
        callback: {
            onClick: function (event, treeId, treeNode) {//事件的类型可变
                edit(treeNode.id);

            }
        }
    };
    layui.use(['form', 'element', 'upload', 'layedit'], function () {
        var form = layui.form
            , layer = layui.layer
            , element = layui.element
            , layedit = layui.layedit
            , upload = layui.upload;
        var editIndex = layedit.build('LAY_demo_editor');
        //执行实例
        //添加弹窗初始化
        $('.layui-btn-small').on('click', function () {
            var addindform = $('#chooseFile').html();
            layer.open({
                type: 1,
                title: '选择附件',
                content: addindform,
                area: ['600px', '400px']
            })
            //选完文件后不自动上传
            upload.render({
                elem: '#test3'
                , url: '/upload/'
                , accept: 'file' //普通文件
                , done: function (res) {
                    console.log(res)
                }
            });
        })
        //添加弹窗初始化
        $('#filesearch').on('click', function () {
            var addindform = $('#chooseFileType').html();
            layer.open({
                type: 1,
                title: '选择文件类型',
                content: addindform,
                area: ['700px', '600px']
            })
        })
        $(function () {
            //主页树加载
            $.ajax({
                async: false,//是否异步
                cache: false,//是否使用缓存
                type: 'GET',//请求方式：post
                dataType: 'json',//数据传输格式：json
                url: 'getKindByTree',//请求的action路径
                success: function (data) {
                    treedata = data;
                    //把后台封装好的简单Json格式赋给treeNodes
                    treeObj = $.fn.zTree.init($(" "),data);
                }
            });
        });
//        function showstation(id) {
//            $("#station").empty();
//            $.ajax({
//                async: false,//是否异步
//                cache: false,//是否使用缓存
//                data: {"id": id},
//                dataType: 'json',//数据传输格式：json
//                url: 'department/getStation',//请求的action路径
//                success: function (data) {
//                    $.each(data, function (idx, obj) {
//                        $("#station").append('<div>' + obj.name + '</div>');
//                    });
//                }
//            });
//        }

        var uploadInst = upload.render({
            elem: '#test1' //绑定元素
            , url: '../file/upload.htmls' //上传接口
            , done: function (res) {
                //上传完毕回调
            }
            , error: function () {
                //请求异常回调
            }
        });
    });
    //    form.on('submit(formDemo)', function (data) {
    //        layer.alert(JSON.stringify(data.field), {
    //            title: '最终的提交信息'
    //        })
    //        return false;
    //    });
</script>
</body>
</html>